{"ast":null,"code":"import React,{useEffect,useRef}from'react';import{useChatStore}from'../store/useChatStore';import ChatHeader from'./ChatHeader';import MessageInput from'./MessageInput';import MessageSkeleton from'./Skeletons/MessageSkeleton';import{useAuthStore}from'../store/useAuthStore';import{formatMessageTime}from'../lib/utils';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChatContainer=()=>{const{messages,getMessages,isMessagesLoading,selectedUser,subscribeToMessages,unsubscribeFromMessages}=useChatStore();const{authUser}=useAuthStore();const messageEndRef=useRef(null);// Fetch messages and set up subscriptions\nuseEffect(()=>{if(!(selectedUser!==null&&selectedUser!==void 0&&selectedUser._id))return;getMessages(selectedUser._id);subscribeToMessages();return()=>{unsubscribeFromMessages();};},[selectedUser===null||selectedUser===void 0?void 0:selectedUser._id,getMessages,subscribeToMessages,unsubscribeFromMessages]);// Auto-scroll to the latest message\nuseEffect(()=>{if(messageEndRef.current&&messages){messageEndRef.current.scrollIntoView({behavior:'smooth'});}},[messages]);if(isMessagesLoading){return/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col overflow-auto\",children:[/*#__PURE__*/_jsx(ChatHeader,{}),/*#__PURE__*/_jsx(MessageSkeleton,{}),/*#__PURE__*/_jsx(MessageInput,{})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 flex flex-col overflow-auto\",children:[/*#__PURE__*/_jsx(ChatHeader,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto p-4 space-y-4\",children:[messages.map(message=>/*#__PURE__*/_jsxs(\"div\",{className:\"chat \".concat(message.senderId===authUser._id?'chat-end':'chat-start'),children:[/*#__PURE__*/_jsx(\"div\",{className:\"chat-image avatar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"size-10 rounded-full border\",children:/*#__PURE__*/_jsx(\"img\",{src:message.senderId===authUser._id?authUser.profilePicture||'logo192.png':selectedUser.profilePicture||'logo192.png',alt:\"profile pic\"})})}),/*#__PURE__*/_jsx(\"div\",{className:\"chat-header mb-1\",children:/*#__PURE__*/_jsx(\"time\",{className:\"text-xs opacity-50 ml=1\",children:formatMessageTime(message.createdAt)})}),/*#__PURE__*/_jsxs(\"div\",{className:\"chat-bubble flex flex-col\",children:[message.image&&/*#__PURE__*/_jsx(\"img\",{src:message.image,alt:\"Attachment\",className:\"sm:max-w-[200px] rounded-md mb-2\"}),message.text&&/*#__PURE__*/_jsx(\"p\",{children:message.text})]})]},message._id)),/*#__PURE__*/_jsx(\"div\",{ref:messageEndRef})]}),/*#__PURE__*/_jsx(MessageInput,{})]});};export default ChatContainer;","map":{"version":3,"names":["React","useEffect","useRef","useChatStore","ChatHeader","MessageInput","MessageSkeleton","useAuthStore","formatMessageTime","jsx","_jsx","jsxs","_jsxs","ChatContainer","messages","getMessages","isMessagesLoading","selectedUser","subscribeToMessages","unsubscribeFromMessages","authUser","messageEndRef","_id","current","scrollIntoView","behavior","className","children","map","message","concat","senderId","src","profilePicture","alt","createdAt","image","text","ref"],"sources":["/Users/achintiii/chat-app/frontend/src/components/ChatContainer.jsx"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\nimport { useChatStore } from '../store/useChatStore';\nimport ChatHeader from './ChatHeader';\nimport MessageInput from './MessageInput';\nimport MessageSkeleton from './Skeletons/MessageSkeleton';\nimport { useAuthStore } from '../store/useAuthStore';\nimport { formatMessageTime } from '../lib/utils';\n\nconst ChatContainer = () => {\n    const { messages, getMessages, isMessagesLoading, selectedUser, subscribeToMessages, unsubscribeFromMessages } = useChatStore();\n    const { authUser } = useAuthStore();\n    const messageEndRef = useRef(null);\n\n    // Fetch messages and set up subscriptions\n    useEffect(() => {\n        if (!selectedUser?._id) return;\n\n        getMessages(selectedUser._id);\n        subscribeToMessages();\n\n        return () => {\n            unsubscribeFromMessages();\n        };\n    }, [selectedUser?._id, getMessages, subscribeToMessages, unsubscribeFromMessages]);\n\n    // Auto-scroll to the latest message\n    useEffect(() => {\n        if (messageEndRef.current && messages) {\n            messageEndRef.current.scrollIntoView({ behavior: 'smooth' });\n        }\n    }, [messages]);\n\n    if (isMessagesLoading) {\n        return (\n            <div className=\"flex-1 flex flex-col overflow-auto\">\n                <ChatHeader />\n                <MessageSkeleton />\n                <MessageInput />\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"flex-1 flex flex-col overflow-auto\">\n            <ChatHeader />\n            <div className=\"flex-1 overflow-y-auto p-4 space-y-4\">\n                {messages.map((message) => (\n                    <div\n                        key={message._id}\n                        className={`chat ${\n                            message.senderId === authUser._id ? 'chat-end' : 'chat-start'\n                        }`}\n                    >\n                        <div className=\"chat-image avatar\">\n                            <div className=\"size-10 rounded-full border\">\n                                <img\n                                    src={\n                                        message.senderId === authUser._id\n                                            ? authUser.profilePicture || 'logo192.png'\n                                            : selectedUser.profilePicture || 'logo192.png'\n                                    }\n                                    alt=\"profile pic\"\n                                />\n                            </div>\n                        </div>\n                        <div className=\"chat-header mb-1\">\n                            <time className=\"text-xs opacity-50 ml=1\">\n                                {formatMessageTime(message.createdAt)}\n                            </time>\n                        </div>\n                        <div className=\"chat-bubble flex flex-col\">\n                            {message.image && (\n                                <img\n                                    src={message.image}\n                                    alt=\"Attachment\"\n                                    className=\"sm:max-w-[200px] rounded-md mb-2\"\n                                />\n                            )}\n                            {message.text && <p>{message.text}</p>}\n                        </div>\n                    </div>\n                ))}\n                {/* Scroll marker */}\n                <div ref={messageEndRef} />\n            </div>\n            <MessageInput />\n        </div>\n    );\n};\n\nexport default ChatContainer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}